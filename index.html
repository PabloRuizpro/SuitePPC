<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Suite PPC - Gesti√≥n inteligente de scripts para PPC con GitHub" />
  <title>Suite PPC - Scripts Inteligentes</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f172a;
      --surface: #1e293b;
      --surface-hover: #334155;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --primary: #3b82f6;
      --danger: #ef4444;
      --success: #10b981;
      --border: #334155;
      --radius: 12px;
      --transition: all 0.2s ease-in-out;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0; font-family: 'Inter', sans-serif;
      background: var(--bg); color: var(--text); line-height: 1.6;
    }
    .container {
      max-width: 1200px; margin: auto; padding: 2rem;
    }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #60a5fa, #818cf8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .status {
      display: flex; justify-content: flex-end; align-items: center; gap: 1rem;
      margin-bottom: 2rem;
    }
    .status span {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.5rem 1rem; border-radius: var(--radius);
      background: var(--surface); font-size: 0.875rem;
      border: 1px solid var(--border);
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--danger); animation: pulse 2s infinite;
    }
    .dot.auth { background: var(--success); }
    @keyframes pulse {
      0%, 100% { opacity: 1; } 50% { opacity: 0.5; }
    }
    button {
      background: var(--primary); border: none;
      padding: 0.6rem 1.2rem; border-radius: var(--radius);
      color: white; font-weight: 500; cursor: pointer;
      transition: var(--transition);
    }
    button:hover {
      background: #2563eb; transform: translateY(-2px);
    }
    .grid {
      display: grid; gap: 2rem;
    }
    .card {
      background: var(--surface); padding: 1.5rem;
      border-radius: var(--radius); border: 1px solid var(--border);
      box-shadow: 0 10px 15px -5px rgba(0,0,0,0.1);
      transition: var(--transition);
    }
    .card:hover {
      transform: translateY(-4px);
      background: var(--surface-hover);
    }
    .card h2 {
      margin: 0 0 1rem 0; font-size: 1.25rem;
    }
    .script {
      background: var(--bg);
      padding: 1rem; border-radius: var(--radius);
      border: 1px solid var(--border); display: flex;
      justify-content: space-between; align-items: center;
    }
    .script-name { font-weight: 500; }
    .message {
      padding: 1rem; border-radius: var(--radius);
      margin: 1rem 0;
    }
    .error { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid var(--danger); }
    .success { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid var(--success); }
    .spinner {
      width: 24px; height: 24px; border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Suite PPC</h1>
    <p>Visualiza y abre tus scripts directamente desde GitHub</p>

    <div class="status">
      <span><div class="dot" id="dot"></div><span id="authText">Desconectado</span></span>
      <button onclick="authenticate()">üîê Conectar</button>
    </div>

    <div id="messageBox"></div>
    <div id="categories" class="grid"></div>
  </div>

  <script>
    const GITHUB_USER = 'pabloruizpro';
    const GITHUB_REPO = 'SuitePPC';
    const BRANCH = 'principal';
    let token = null;

    const categoriesContainer = document.getElementById('categories');
    const dot = document.getElementById('dot');
    const authText = document.getElementById('authText');

    function showMessage(msg, type = 'error') {
      const box = document.getElementById('messageBox');
      box.innerHTML = `<div class="message ${type}">${msg}</div>`;
      setTimeout(() => { box.innerHTML = ''; }, 5000);
    }

    function authenticate() {
      const input = prompt("Introduce tu token de GitHub (ghp_... o github_pat_...)");
      if (!input || !/^gh(p|ub)_/.test(input)) return showMessage("Token inv√°lido");
      token = input;
      dot.classList.add('auth');
      authText.textContent = 'Autenticado';
      fetchCategories();
    }

    async function fetchFromGitHub(url) {
      const headers = {
        Accept: "application/vnd.github.v3+json",
        ...(token && { Authorization: `Bearer ${token}` })
      };
      const res = await fetch(url, { headers });
      if (!res.ok) throw new Error(`GitHub API: ${res.status}`);
      return res.json();
    }

    async function fetchCategories() {
      categoriesContainer.innerHTML = '<div class="spinner"></div>';
      try {
        const base = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/scripts`;
        const folders = await fetchFromGitHub(base);
        const dirs = folders.filter(f => f.type === 'dir');

        const all = await Promise.all(dirs.map(async dir => {
          const items = await fetchFromGitHub(`${base}/${dir.name}`);
          return {
            name: dir.name,
            scripts: items.filter(i => i.name.endsWith('.py'))
          };
        }));

        renderCategories(all);
      } catch (err) {
        console.error(err);
        showMessage('Error cargando scripts', 'error');
      }
    }

    function renderCategories(data) {
      categoriesContainer.innerHTML = data.map(cat => `
        <div class="card">
          <h2>üìÅ ${cat.name}</h2>
          ${cat.scripts.length === 0 ? `<p style="color: var(--muted)">Sin scripts</p>` :
            cat.scripts.map(s => `
              <div class="script">
                <span class="script-name">üêç ${s.name}</span>
                <button onclick="openColab('${s.download_url}', '${s.name}')">üöÄ Abrir en Colab</button>
              </div>
            `).join('')
          }
        </div>
      `).join('');
    }

    async function openColab(url, name) {
      try {
        const res = await fetch(url);
        const code = await res.text();
        const notebook = {
          nbformat: 4,
          nbformat_minor: 0,
          metadata: {
            colab: { name, provenance: [] },
            kernelspec: { name: "python3", display_name: "Python 3" }
          },
          cells: [{
            cell_type: "code",
            source: code.split("\n"),
            metadata: {},
            outputs: [],
            execution_count: null
          }]
        };
        const blob = new Blob([JSON.stringify(notebook)], { type: 'application/json' });
        const notebookUrl = URL.createObjectURL(blob);
        window.open(`https://colab.research.google.com/notebook#fileId=${notebookUrl}`, '_blank');
        setTimeout(() => URL.revokeObjectURL(notebookUrl), 3000);
      } catch (e) {
        console.error(e);
        showMessage("Error al abrir en Colab");
      }
    }
  </script>
</body>
</html>

  
